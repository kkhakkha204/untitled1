<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Thanh toán</title>
    <style>
        body{font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; margin:0; background:#0f172a; color:#e2e8f0; display:flex; min-height:100vh; align-items:center; justify-content:center;}
        .card{background:#111827; border:1px solid #1f2937; border-radius:20px; padding:24px; width:min(680px,92vw); box-shadow:0 10px 30px rgba(0,0,0,.35)}
        .row{display:flex; gap:20px; flex-wrap:wrap;}
        .left{flex:1 1 280px; text-align:center}
        .right{flex:1 1 280px;}
        img{width:320px; height:320px; object-fit:contain; background:#fff; border-radius:12px; padding:8px;}
        h1{font-size:24px; margin:0 0 12px}
        .kv{margin:10px 0; font-size:16px}
        .kv b{display:inline-block; min-width:140px; color:#93c5fd}
        .money{font-size:28px; font-weight:700; color:#86efac}
        .footer{margin-top:14px; font-size:12px; color:#94a3b8}
        .empty{text-align:center; opacity:.9}
    </style>
</head>
<body>
<div class="card" id="root">
    <div class="empty">Đang tải…</div>
</div>

<script>
    const API_URL = 'https://<n8n-domain>/webhook/display-json'; // đổi đúng path

    function formatVND(v){ try{ return Number(v||0).toLocaleString('vi-VN') + ' ₫'; } catch(e){ return v||''; } }

    async function load(){
        try{
            const res = await fetch(API_URL, { cache: 'no-store' });
            const { data } = await res.json();
            const root = document.getElementById('root');

            if(!data || Object.keys(data).length===0){
                root.innerHTML = `<div class="empty">Đang chờ đơn hàng NEW…</div>`;
                return;
            }

            root.innerHTML = `
      <div class="row">
        <div class="left">
          <img src="${data.url_qr}" alt="QR thanh toán" />
          <div class="footer">Quét mã để thanh toán • Mã đơn: ${data.order_ID || data.id}</div>
        </div>
        <div class="right">
          <h1>Thông tin thanh toán</h1>
          <div class="kv"><b>Khách hàng:</b> ${data.name||''}</div>
          <div class="kv"><b>Điện thoại:</b> ${data.phone||''}</div>
          <div class="kv"><b>Dịch vụ/SP:</b> ${data.product_service||''}</div>
          <div class="kv money"><b>Số tiền:</b> ${formatVND(data.money)}</div>
        </div>
      </div>
    `;
        } catch(e){
            document.getElementById('root').innerHTML = `<div class="empty">Lỗi tải dữ liệu</div>`;
            console.error(e);
        }
    }

    load();
    setInterval(load, 8000); // refresh mỗi 8s
</script>
</body>
</html>
